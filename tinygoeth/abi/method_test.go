package abi

import (
	"bytes"
	"encoding/hex"
	"math/big"
	"testing"

	"github.com/machinefi/w3bstream-wasm-golang-sdk/tinygoeth/address"
)

func TestPack(t *testing.T) {
	m, err := NewMethod("confirm(string,address,uint32,bytes,uint256,uint32)")
	if err != nil {
		t.Fatalf("error: %s", err)
	}
	data, err := m.Pack("AAAAA", address.HexToAddress("0xbb6c0bdfec9b5f77050dd9b73d645aa0aa08f20d"), uint32(1), []byte("BBBBB"), big.NewInt(2), uint32(3))
	if err != nil {
		t.Fatalf("error: %s", err)
	}

	want, _ := hex.DecodeString("2409556e00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000bb6c0bdfec9b5f77050dd9b73d645aa0aa08f20d00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000005414141414100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000054242424242000000000000000000000000000000000000000000000000000000")
	if !bytes.Equal(data, want) {
		t.Fatalf("pack error got %x, want %x", data, want)
	}
}
